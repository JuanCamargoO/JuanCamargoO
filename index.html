<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAR Application</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <style>
        .buttons {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5em;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        .buttons button {
            padding: 0.25em;
            border-radius: 4px;
            border: none;
            background: white;
            color: black;
            width: 4em;
            height: 2em;
            margin: 0 0.5em;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <div class="buttons">
        <button id="takePhoto">Photo</button>
        <button id="startStopVideo">Video</button>
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false;"
    >
        <a-assets>
            <a-asset-item id="model1" src="model1.glb"></a-asset-item>
            <a-asset-item id="model2" src="model2.glb"></a-asset-item>
            <a-asset-item id="model3" src="model3.glb"></a-asset-item>
            <a-asset-item id="model4" src="model4.glb"></a-asset-item>
            <a-asset-item id="model5" src="model5.glb"></a-asset-item>
            <a-asset-item id="model6" src="model6.glb"></a-asset-item>
        </a-assets>

        <a-marker type="pattern" url="marker1.patt">
            <a-entity gltf-model="#model1" scale="0.1 0.1 0.1"></a-entity>
        </a-marker>
        <a-marker type="pattern" url="marker2.patt">
            <a-entity gltf-model="#model2" scale="0.1 0.1 0.1"></a-entity>
        </a-marker>
        <a-marker type="pattern" url="marker3.patt">
            <a-entity gltf-model="#model3" scale="0.1 0.1 0.1"></a-entity>
        </a-marker>
        <a-marker type="pattern" url="marker4.patt">
            <a-entity gltf-model="#model4" scale="0.1 0.1 0.1"></a-entity>
        </a-marker>
        <a-marker type="pattern" url="marker5.patt">
            <a-entity gltf-model="#model5" scale="0.1 0.1 0.1"></a-entity>
        </a-marker>
        <a-marker type="pattern" url="marker6.patt">
            <a-entity gltf-model="#model6" scale="0.1 0.1 0.1"></a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const photoButton = document.getElementById('takePhoto');
            const videoButton = document.getElementById('startStopVideo');
            let mediaRecorder;
            let recordedChunks = [];

            // Geolocation and distance calculation
            const targetLat = 8.950770;
            const targetLon = -79.670572;
            const maxDistance = 50; // Maximum distance in meters

            function calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 6371e3;
                const φ1 = lat1 * Math.PI / 180;
                const φ2 = lat2 * Math.PI / 180;
                const Δφ = (lat2 - lat1) * Math.PI / 180;
                const Δλ = (lon2 - lon1) * Math.PI / 180;

                const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                          Math.cos(φ1) * Math.cos(φ2) *
                          Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

                return R * c;
            }

            function checkLocation() {
                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        const distance = calculateDistance(position.coords.latitude, position.coords.longitude, targetLat, targetLon);
                        if (distance > maxDistance) {
                            window.location.href = "https://www.youtube.com/watch?v=YOUR_YOUTUBE_VIDEO_ID";
                        }
                    });
                }
            }

            // Check location every 30 seconds
            setInterval(checkLocation, 30000);

            photoButton.addEventListener('click', function() {
                const scene = document.querySelector('a-scene');
                const img = scene.components.screenshot.getCanvas('perspective').toDataURL('image/png');
                const link = document.createElement('a');
                link.href = img;
                link.download = 'ar-screenshot.png';
                link.click();
            });

            videoButton.addEventListener('click', function() {
                const scene = document.querySelector('a-scene');
                if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                    const stream = scene.components.screenshot.getCanvas('perspective').captureStream(25);
                    mediaRecorder = new MediaRecorder(stream, {mimeType: 'video/webm'});
                    mediaRecorder.ondataavailable = (event) => {
                        if (event.data.size > 0) {
                            recordedChunks.push(event.data);
                        }
                    };
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(recordedChunks, {type: 'video/webm'});
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = 'ar-video.webm';
                        link.click();
                        recordedChunks = [];
                    };
                    mediaRecorder.start();
                    videoButton.textContent = 'Stop';
                } else {
                    mediaRecorder.stop();
                    videoButton.textContent = 'Video';
                }
            });
        });
    </script>
</body>
</html>
